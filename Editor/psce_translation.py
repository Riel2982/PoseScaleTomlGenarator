class TranslationManager:
    def __init__(self):
        self.current_lang = "en"
        self.translations = {
            "en": {
                "window_title": "PoseScale Config Editor",
                "tab_general": "General Settings",
                "tab_profiles": "Toml Profiles",
                "tab_pose_data": "Pose Scale Data",
                "tab_pose_id_map": "Pose ID Map",
                "tab_key_map": "KeyMap",
                # 一般設定タブ
                "farc_settings": "FarcPack Settings",
                "farc_path": "FarcPack Path:",
                "browse": "Browse",
                "gen_settings": "General Settings",
                "save_parent": "Save In Parent Directory",
                "def_pose_name": "Default Pose File Name:",
                "use_module_match": "Use Module Name Contains (Enable Profiles)",
                "use_module_name_contains": "Use Module Name Contains (Enable Profiles)",
                "debug_settings": "Debug Settings",
                "output_log": "Output Log (Debug)",
                "delete_temp": "Delete Temp Folder After Execution",
                "lang_settings": "Language Settings",
                "switch_lang": "Switch Language",
                "restart_req": "Restart required to apply some changes.",
                "show_debug": "Show Debug Settings",
                "overwrite_existing": "Overwrite Existing Files (No Backup)",
                "undo_limit": "Undo/Redo Limit (50-150):",
                "save_gen_settings": "Save General Settings",
                # TomlProfileタブ
                "edit_profile": "Edit Profile",
                "add_new": "Add New",
                "duplicate": "Duplicate",
                "up": "Up",
                "down": "Down",
                "delete": "Delete",
                "section_name": "Section Name:",
                "module_match": "Module Match (comma separated):",
                "module_exclude": "Module Exclude (comma separated):",
                "config_file": "Config File (Base Name in PoseScaleData):",
                "edit_this_file": "Edit this File",
                "pose_file_output": "Pose File Name (Output):",
                "update_save_profile": "Update/Save Profile",
                "target_file": "Target File:",
                "refresh": "Refresh",
                "create_new_file": "Create New File",
                "duplicate_file": "Duplicate File",
                "rename_file": "Rename File",
                "delete_file": "Delete File",
                "edit_setting": "Edit Setting",
                "chara": "Chara (e.g. MIKU, RIN):",
                "module_name_contains": "Module Name Contains:",
                "pose_id": "Pose ID:",
                "scale": "Scale:",
                "update_save_file": "Update/Save to File",
                "edit_mapping": "Edit Mapping",
                "pose_id_num": "Pose ID (Number):",
                "pose_name": "Pose Name:",
                "pose_name_desc": "Pose Name (Description):",
                "update_save_map": "Update/Save Map",
                "confirm": "Confirm",
                "error": "Error",
                "success": "Success",
                # ポップアップメッセージ
                "delete_confirm_profile": "Delete profile '{}'?",
                "delete_confirm_pose": "Delete section '{}'?",
                "delete_confirm_map": "Delete mapping for ID {}?",
                "delete_confirm_file": "Delete file '{}'?",
                "file_not_found": "File Not Found",
                "create_it": "{} does not exist. Create it?",
                "failed_create": "Failed to create file: {}",
                "failed_save": "Failed to save file:\n{}",
                "failed_load": "Failed to load file:\n{}",
                "req_suffix": "Section Suffix is required.",
                "req_id_name": "Both ID and Name are required.",
                "no_file_selected": "No file selected.",
                "err_filename_chars": "File Name must be half-width alphanumeric and symbols (., -, _) only.",
                # PosIDMapタブ
                "image_preview": "Image Preview",
                "select_image": "Select Image",
                "no_image": "No Image",
                "copy_image_fail": "Failed to copy image: {}",
                "settings_saved": "Settings saved.",
                "reset_defaults": "Reset to Defaults",
                "reset_confirm": "Reset all settings to default? This cannot be undone.",
                "duplicate_section_error": "Section '{}' already exists. Cannot save.",
                "overwrite_confirm": "ID '{}' already exists. Overwrite?",
                "image_import_error": "Failed to import image: {}",
                "req_id_name_for_image": "Please set Pose ID and Name before selecting an image.",
                "delete_image": "Delete Image",
                "delete_image_confirm": "Delete image '{}'? This cannot be undone.",
                "save_restart": "Save & Restart",
                "save_restart_confirm": "Save settings and restart application?",
                "invalid_farcpack_path": "Invalid FarcPack path. Please select FarcPack.exe.",
                "undo": "Undo",
                "redo": "Redo",
                "enter_filename": "Enter new file name (without .ini):",
                # ステータスバーメッセージ
                "msg_no_changes": "No changes to save.",
                "msg_saved_general": "General settings saved.",
                "msg_saved_profile": "'TomlProfile_{} 'saved.",
                "msg_saved_data": "'PoseScaleSetting_{}' saved.",
                "msg_saved_map": "'Pose ID: {}' saved.",
                "msg_added_profile": "'TomlProfile_{} 'added.",
                "msg_duplicated_profile": "'TomlProfile_{} 'duplicated.",
                "msg_deleted_profile": "'TomlProfile_{} 'deleted.",
                "msg_added_data": "'PoseScaleSettings_{} 'added.",
                "msg_duplicated_data": "'PoseScaleSettings_{} 'duplicated.",
                "msg_deleted_data": "'PoseScaleSettings_{} 'deleted.",
                "msg_deleted_file": "'{} 'deleted.",   
                "msg_added_map": "'Pose ID: {} 'added.",
                "msg_duplicated_map": "'Pose ID: {} 'duplicated.",
                "msg_deleted_map": "'Pose ID: {} 'deleted.",
                "msg_added_image": "Pose image file added.",
                "msg_deleted_image": "Pose image file deleted.",
                "err_file_exists": "File '{}' already exists.",
                "err_failed_create": "Failed to create file: {}",
                "err_failed_duplicate": "Failed to duplicate file: {}",
                "err_failed_rename": "Failed to rename file: {}",
                "err_failed_delete": "Failed to delete file: {}",
                "err_load_config_fatal": "Failed to load Config.ini.\nFile might be locked or corrupted.\nApplication will exit to prevent data loss.",
                "msg_canceled": "Operation canceled.",
                "msg_created_file": "File '{}' created.",
                "msg_duplicated_file": "File '{}' duplicated.",
                "msg_renamed_file": "File renamed to '{}'.",
                # KeyMapタブ
                "save_keymap": "Save KeyMap Settings",
                "key_capture_title": "Press Key",
                "key_capture_desc": "Press the key combination you want to set.\n(Press OK to confirm, Clear to remove all)",
                "clear": "Clear",
                "cancel": "Cancel",
                "edit": "Edit",
                "action_save_current_tab": "Save Current Tab",
                "action_save_and_exit": "Save & Exit",
                "action_exit_no_save": "Exit (No Save)",
                "action_restart_no_save": "Restart (No Save)",
                "action_save_and_restart": "Save & Restart",
                "action_undo": "Undo",
                "action_redo": "Redo",
                "action_toggle_debug": "Toggle Debug Settings",
                "keymap_tab_title": "Shortcut Key Settings",
                "keymap_restore_default": "Default",
                "keymap_saved": "KeyMap settings saved and applied.",
                "keymap_no_changes": "No changes made.",
                "keymap_reset": "KeyMap settings reset.",
                "refresh_tab": "Refresh Tab",
            },
            "ja": {
                "window_title": "PoseScale 設定エディタ",
                "tab_general": "一般設定",
                "tab_profiles": "Tomlプロファイル",
                "tab_pose_data": "Pose Scale データ",
                "tab_pose_id_map": "Pose ID マップ",
                "tab_key_map": "ショートカットキー設定",
                # GeneralSettingsタブ
                "farc_settings": "FarcPack 設定",
                "farc_path": "FarcPack パス:",
                "browse": "参照",
                "gen_settings": "一般設定",
                "save_parent": "TOMLファイルを親ディレクトリに保存",
                "def_pose_name": "デフォルトPoseファイル名:",
                "use_module_match": "Tomlプロファイルを有効化（モジュール名一致を使用）",
                "use_module_name_contains": "Tomlプロファイルを有効化（モジュール名一致を使用）",
                "debug_settings": "デバッグ設定",
                "output_log": "ログ出力 (デバッグ)",
                "delete_temp": "実行後にTempフォルダを削除",
                "lang_settings": "言語設定",
                "switch_lang": "言語切り替え",
                "restart_req": "言語変更を適用するには再起動が必要です。",
                "show_debug": "デバッグ設定の有効化",
                "overwrite_existing": "既存ファイルを上書きする",
                "undo_limit": "Undo/Redo 履歴制限数 (50-150):",
                "save_gen_settings": "設定を保存",
                # TomlProfilesタブ
                "edit_profile": "プロファイル編集",
                "add_new": "新規追加",
                "duplicate": "複製",
                "up": "上に移動",
                "down": "下に移動",
                "delete": "削除",
                "section_name": "セクション名:",
                "module_match": "モジュール一致 (カンマ区切り):",
                "module_exclude": "モジュール除外 (カンマ区切り):",
                "config_file": "PoseScale設定ファイル:",
                "edit_this_file": "ファイルを編集",
                "pose_file_output": "Poseファイル名 (出力):",
                "update_save_profile": "Tomlプロファイルを更新",
                # PoseScaleDataタブ
                "target_file": "対象ファイル:",
                "refresh": "更新",
                "create_new_file": "新規ファイル作成",
                "duplicate_file": "ファイルを複製",
                "rename_file": "ファイル名変更",
                "delete_file": "ファイルを削除",
                "edit_setting": "設定編集",
                "chara": "キャラ (例: MIKU, RIN):",
                "module_name_contains": "モジュール一致 (カンマ区切り):",
                "pose_id": "Pose ID:",
                "scale": "スケール:",
                # PoseIDMapタブ
                "update_save_file": "Settingを更新",
                "edit_mapping": "マッピング編集",
                "pose_id_num": "Pose ID (数値):",
                "pose_name": "Pose名:",
                "pose_name_desc": "Pose名 (説明):",
                "update_save_map": "Pose ID マップを更新",
                "image_preview": "ポーズプレビュー",
                "select_image": "画像選択",
                "no_image": "画像なし",
                "copy_image_fail": "画像のコピーに失敗しました: {}",
                "settings_saved": "設定を保存しました。",
                "reset_defaults": "デフォルトに戻す",
                "delete_image": "画像削除",
                "confirm": "確認",
                "error": "エラー",
                "success": "成功",
                # ポップアップメッセージ
                "delete_confirm_profile": "プロファイル '{}' を削除しますか？",
                "delete_confirm_pose": "セクション '{}' を削除しますか？",
                "delete_confirm_map": "ID {} のマッピングを削除しますか？",
                "delete_confirm_file": "ファイル '{}' を削除しますか？",
                "file_not_found": "ファイルが見つかりません",
                "create_it": "{} が存在しません。作成しますか？",
                "failed_create": "ファイルの作成に失敗しました: {}",
                "failed_save": "ファイルの保存に失敗しました:\n{}",
                "failed_load": "ファイルの読み込みに失敗しました:\n{}",
                "req_suffix": "セクションのサフィックスは必須です。",
                "req_id_name": "IDと名前の両方が必要です。",
                "no_file_selected": "ファイルが選択されていません。",
                "reset_confirm": "すべての設定をデフォルトに戻しますか？ この操作は取り消せません。",
                "duplicate_section_error": "セクション '{}' は既に存在します。",
                "overwrite_confirm": "ID '{}' は既に存在します。上書きしますか？",
                "image_import_error": "画像のインポートに失敗しました: {}",
                "req_id_name_for_image": "画像を選択する前にPose IDと名前を設定してください。",
                "delete_image_confirm": "画像 '{}' を削除しますか？ この操作は取り消せません。",
                "save_restart_confirm": "設定を保存してアプリケーションを再起動しますか？",
                "invalid_farcpack_path": "FarcPack のパスが無効です。FarcPack.exe を選択してください。",
                "undo": "元に戻す",
                "redo": "やり直し",
                "enter_filename": "新しいファイル名を入力してください (.iniなし):",
                # ステータスメッセージ
                "msg_no_changes": "変更はありません（保存キャンセル）。",
                "msg_saved_general": "設定を保存しました。",
                "msg_saved_profile": "TomlProfile_{} を保存しました。",
                "msg_saved_data": "PoseScaleSettings_{} を保存しました。",
                "msg_saved_map": "Pose ID: {} を保存しました。",
                "msg_added_profile": "TomlProfile_{} を追加しました。",
                "msg_duplicated_profile": "TomlProfile_{} を複製しました。",
                "msg_deleted_profile": "TomlProfile_{} を削除しました。",
                "msg_added_data": "PoseScaleSettings_{} を追加しました。",
                "msg_duplicated_data": "PoseScaleSettings_{} を複製しました。",
                "msg_deleted_data": "PoseScaleSettings_{} を削除しました。",
                "msg_deleted_file": "{} を削除しました。",   
                "msg_added_map": "Pose ID: {} を追加しました。",
                "msg_duplicated_map": "Pose ID: {} を複製しました。",
                "msg_deleted_map": "Pose ID: {} を削除しました。",
                "msg_added_image": "ポーズ参考画像を追加しました。",
                "msg_deleted_image": "ポーズ参考画像を削除しました。",
                "err_file_exists": "ファイル '{}' は既に存在します。",
                "err_failed_create": "ファイルの作成に失敗しました: {}",
                "err_failed_duplicate": "ファイルの複製に失敗しました: {}",
                "err_failed_rename": "ファイル名の変更に失敗しました: {}",
                "err_failed_delete": "ファイルの削除に失敗しました: {}",
                "err_load_config_fatal": "Config.ini の読み込みに失敗しました。\nファイルがロックされているか破損している可能性があります。\nデータ損失を防ぐためアプリケーションを終了します。",
                "msg_canceled": "操作がキャンセルされました。",
                "msg_created_file": "ファイル '{}' を作成しました。",
                "msg_duplicated_file": "ファイル '{}' を複製しました。",
                "msg_renamed_file": "ファイル名を '{}' に変更しました。",
                # KeyMapタブ
                "save_keymap": "KeyMap設定を保存",
                "key_capture_title": "キー入力",
                "key_capture_desc": "設定したいキーの組み合わせを押してください。\n(OKで確定、Clearで全消去)",
                "clear": "クリア",
                "cancel": "キャンセル",
                "edit": "編集",
                "action_save_current_tab": "現在のタブを保存",
                "action_save_and_exit": "保存して終了",
                "action_exit_no_save": "保存せずに終了",
                "action_restart_no_save": "保存せずに再起動",
                "action_save_and_restart": "保存して再起動",
                "action_undo": "元に戻す",
                "action_redo": "やり直し",
                "action_toggle_debug": "デバッグ設定の有効化",
                "keymap_tab_title": "ショートカットキー設定",
                "keymap_restore_default": "デフォルトに戻す",
                "keymap_saved": "KeyMap設定を保存しました。",
                "keymap_no_changes": "変更がありません。",
                "err_filename_chars": "ファイル名は半角英数字と一部記号のみ使用可能です。",
                "keymap_reset": "ショートカットキー設定をリセットしました",
                "refresh_tab": "再読み込み",
            },
        }

    def get(self, key, *args):
        lang_dict = self.translations.get(self.current_lang, self.translations["en"])
        text = lang_dict.get(key, key)
        if args:
            try:
                return text.format(*args)
            except IndexError:
                return text
        return text

    def set_language(self, lang):
        if lang in self.translations:
            self.current_lang = lang
